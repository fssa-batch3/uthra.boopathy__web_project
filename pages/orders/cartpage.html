<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title> Add to cart page </title>
        <link rel="stylesheet" href="../../assets/css/style-cartpage.css">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css" integrity="sha512-MV7K8+y+gLIBoVD59lQIYicR65iaqukzvf/nwasF0nqhPay5w/9lJmVM2hMDcnK1OnMGCdVK+iQrJ7lzPJQd1w==" crossorigin="anonymous" referrerpolicy="no-referrer">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Kreon:wght@300;400;500;600;700&family=Kumbh+Sans:wght@100;200;300;400;500;600;700;800;900&family=Parisienne&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
    </head>
    
    <body>
        <header id="userLogin">

        </header>

        <div class="arrows"></div>

        <section>

        </section>

        <footer>
            <div class="top">
                <div class="about">
                    <h4> About: </h4>
                    <div class="us">
                        <p>
                          <a href="../homepage/aboutus.html"> About us </a>
                        </p> 
                        <p>
                          <a href="#"> Available Products </a>
                        </p>
                        <p>
                          <a href="#"> Security </a>
                        </p> 
                        <p>
                          <a href="../homepage/termsofuse.html"> Terms of use </a> 
                        </p> 
                        <p>
                          <a href="../homepage/return.html"> Return policy </a>
                        </p> 
           </div>
          </div>

                                            <div class="line"></div>

                                            <div class="contact">  
                 
                                                <div class="socials">
                                                    <span class="con"> Contact us: </span>
                                                    <div class="insta">
                                                        <i class="fa-brands fa-instagram"></i> 
                                                    </div>
                                                    <div class="fb">
                                                        <i class="fa-brands fa-facebook-f"></i> 
                                                    </div>
                                                    <div class="twiter">
                                                        <i class="fa-brands fa-twitter"></i> 
                                                    </div>
                                                    <div class="wa">
                                                        <i class="fa-brands fa-whatsapp"></i> 
                                                    </div>
                                                </div>
                                                <div>
                                                    <p>Copy rights @ 2022</p>
                                                </div>
                                            </div>
       </div>

       </footer>    
<script src="../../assets/js/header.js"> </script>

<script>
// <div class = "arrow" > </div>

const div_arrow = document.createElement("div");
div_arrow.setAttribute("class", "arrow");
// console.log(div_arrow);

// <a> link </a>

const a_arrow = document.createElement("a");
a_arrow.setAttribute("href", "../homepage/frontpage.html");
div_arrow.append(a_arrow);
// console.log(a_arrow);

// < i >  arrow </i>

const i_arrow = document.createElement("i");
i_arrow.setAttribute("class", "fa-solid fa-arrow-left");
a_arrow.append(i_arrow);

document.querySelector("div.arrows").append(div_arrow);

const add_to_cart = JSON.parse(localStorage.getItem("cart"));
// console.log(cart);

const unique_id = JSON.parse(localStorage.getItem("uniqueID"));

const check_pdt = add_to_cart.filter((e) => e.buyer_id === unique_id);
// console.log(check_pdt);

for (let k = 0; k < check_pdt.length; k++) {
  // <div class = products >

  const div_container = document.createElement("div");
  div_container.setAttribute("class", "container");
  console.log(div_container);

  // <img>

  const img = document.createElement("img");
  img.setAttribute("src", check_pdt[k].image);
  img.setAttribute("alt", "photo");
  img.setAttribute("height", "200px");
  img.setAttribute("width", "180px");
  div_container.append(img);

  // <div class="details"></div>

  const div_details = document.createElement("div");
  div_details.setAttribute("class", "details");
  div_container.append(div_details);

  // <h3> </h3>

  const h3_title = document.createElement("h3");
  h3_title.setAttribute("id", "name");
  h3_title.innerText = check_pdt[k].name;
  div_details.append(h3_title);

  // <div> </div>

  const div = document.createElement("div");
  h3_title.append(div);

  // <p> </p>

  const p_org = document.createElement("p");
  p_org.setAttribute("id", "original_price");
  p_org.innerText = `₹${check_pdt[k].discount_price}`;
  div.append(p_org);

  // <s> </s>

  const s = document.createElement("s");
  s.setAttribute("id", "discount_price");
  s.innerText = `₹${check_pdt[k].original_price}`;
  div.append(s);

  // <span> </span>

  const span = document.createElement("span");
  span.setAttribute("class", "percent");
  span.innerText = `${check_pdt[k].discount_percent}%off`;
  div.append(span);

  // < div class = "quantity" > </div>

  const div_quantity = document.createElement("div");
  div.append(div_quantity);

  // <p> </p>

  const p_qty = document.createElement("p");
  // p_qty.setAttribute("class", "quantities");
  p_qty.innerText = "Quantity  ";
  div.append(p_qty);

  // <input>

  const input = document.createElement("input");
  input.setAttribute("class", "quantity");
  input.setAttribute("type", "number");
  input.setAttribute("value", check_pdt[k].product_quantity);
  input.setAttribute("id", "product_quantity");
  input.setAttribute("min", "1");
  input.setAttribute("data-remove", check_pdt[k].product_id);
  p_qty.append(input);

  // < button class = "remove" > </button>

  const button_remove = document.createElement("button");
  button_remove.setAttribute("class", "remove");
  button_remove.setAttribute("data-remove", check_pdt[k].product_id);
  button_remove.setAttribute("type", "submit");
  button_remove.innerText = "REMOVE";
  div_container.append(button_remove);

  const button_wish = document.createElement("button");
  button_wish.setAttribute("class", "wish");
  button_wish.setAttribute("data-remove", check_pdt[k].product_id);
  button_wish.setAttribute("type", "submit");
  button_wish.setAttribute("onclick", "move_to_wishlist()");
  button_wish.innerText = "WISHLIST";
  div_container.append(button_wish);

  document.querySelector("section").append(div_container);
}

// let sum = check_pdt;

let total = 0;

for (let l = 0; l < check_pdt.length; l++) {
  total += check_pdt[l].discount_price * check_pdt[l].product_quantity;
}

console.log(total);

// <div class = "total" > </div>

const div_total = document.createElement("div");
div_total.setAttribute("class", "total");
console.log(div_total);

// <div></div>

const div_price = document.createElement("div");
div_total.append(div_price);

// <p>

const p_sub = document.createElement("p");
p_sub.innerText = "SUB TOTAL:";
div_price.append(p_sub);

// <p>

const p_del = document.createElement("p");
p_del.innerText = "DELIVERY CHARGE:";
p_sub.append(p_del);

// <p>

const p_t_a = document.createElement("p");
p_t_a.innerText = "TOTAL AMOUNT:";
p_del.append(p_t_a);

//  <div> <div>

const div_amt = document.createElement("div");
div_total.append(div_amt);
console.log(div_amt);

// <p>

let p_amt = document.createElement("p");
// p_amt.setAttribute("id", "discount_price");
p_amt.innerText = `₹  ${total}`;
div_amt.append(p_amt);

// <p>

const p_free = document.createElement("p");
p_free.innerText = "FREE";
p_amt.append(p_free);

// <p>

p_amt = document.createElement("p");
p_amt.setAttribute("class", "total_amt");
p_amt.innerText = `₹  ${total}`;
p_free.append(p_amt);

// <div>

const div_btn = document.createElement("div");
div_total.append(div_btn);

// < button class = "buy" > </button>

const button_buy = document.createElement("button");
button_buy.setAttribute("class", "buy");
button_buy.innerText = "BUY NOW";
div_btn.append(button_buy);

document.querySelector("section").append(div_total);

const product_quantity = document.querySelectorAll(".quantity");

product_quantity.forEach((add) => {
  add.addEventListener("change", (e) => {
    const productId = e.currentTarget.dataset.remove;

    localStorage.setItem("products_id", JSON.stringify(productId));

    console.log(productId);

    const productid = JSON.parse(localStorage.getItem("products_id"));

    // console.log(productid);

    const all_products = JSON.parse(localStorage.getItem("cart"));

    // console.log(all_products);

    const pdts = all_products.find(
      (e) => e.product_id === productid && e.buyer_id === unique_id
    );

    // console.log(pdts);

    // let ogPrice = pdts[document.getElementById("original_price").value]
    let ogPrice = pdts.discount_price;
    console.log(ogPrice);

    const parent = e.currentTarget.closest(".container");

    console.log(parent);

    const qauntity = parent.querySelector(".quantity").value;

    // let qauntity= document.getElementById("product_quantity").value
    console.log(qauntity);

    const cartPrice = ogPrice * qauntity;
    // console.log(cartPrice)

    ogPrice = cartPrice;
    console.log(ogPrice);

    pdts.product_quantity = qauntity;

    localStorage.setItem("cart", JSON.stringify(all_products));

    window.location.reload();
  });
});

// function remove_pdt () {

const products = document.querySelectorAll("button.remove");

products.forEach((check) => {
  check.addEventListener("click", (e) => {
    const product_id = e.currentTarget.dataset.remove;

    localStorage.setItem("products_id", JSON.stringify(product_id));

    console.log(product_id);

    if (window.confirm("Are you sure to remove this product?")) {
      const id = JSON.parse(localStorage.getItem("products_id"));

      const all_products = JSON.parse(localStorage.getItem("cart"));

      console.log(all_products);

      const pdts = all_products.find(
        (e) => e.product_id === id && e.buyer_id === unique_id
      );

      console.log(pdts);

      const indexOfProduct = all_products.indexOf(pdts);

      all_products.splice(indexOfProduct, 1);

      console.log(indexOfProduct);

      localStorage.setItem("cart", JSON.stringify(all_products));
    }

    window.location.reload();
  });
});

// MOVE TO WISHLIST

function move_to_wishlist() {
  const product = document.querySelectorAll("button.wish");

  product.forEach((check) => {
    check.addEventListener("click", (e) => {
      const product_id = e.currentTarget.dataset.remove;

      localStorage.setItem("products_id", JSON.stringify(product_id));

      console.log(product_id);

      if (window.confirm("Are you sure to move this product to wishlist?")) {
        const id = JSON.parse(localStorage.getItem("products_id"));

        const user_id = JSON.parse(localStorage.getItem("uniqueID"));

        const all_products = JSON.parse(localStorage.getItem("cart"));

        console.log(all_products);

        const pdts = all_products.find(
          (e) => e.product_id === id && e.buyer_id === user_id
        );

        console.log(pdts);

        const indexOfProduct = all_products.indexOf(pdts);

        all_products.splice(indexOfProduct, 1);

        console.log(indexOfProduct);

        const wish_products = JSON.parse(localStorage.getItem("wish")) || [];

        wish_products.push(pdts);

        localStorage.setItem("wish", JSON.stringify(wish_products));

        localStorage.setItem("cart", JSON.stringify(all_products));
      }

      window.location.reload();
    });
  });
}
</script>

    </body>
</html>   